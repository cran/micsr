<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Yves Croissant" />


<title>Implementation of Shi’s non-degeranate Vuong test</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<style type="text/css">
.lightable-minimal {
border-collapse: separate;
border-spacing: 16px 1px;
width: 100%;
margin-bottom: 10px;
}
.lightable-minimal td {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal th {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal thead tr:last-child th {
border-bottom: 2px solid #00000050;
empty-cells: hide;
}
.lightable-minimal tbody tr:first-child td {
padding-top: 0.5em;
}
.lightable-minimal.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-minimal.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic {
border-top: 0.16em solid #111111;
border-bottom: 0.16em solid #111111;
width: 100%;
margin-bottom: 10px;
margin: 10px 5px;
}
.lightable-classic tfoot tr td {
border: 0;
}
.lightable-classic tfoot tr:first-child td {
border-top: 0.14em solid #111111;
}
.lightable-classic caption {
color: #222222;
}
.lightable-classic td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic thead tr:last-child th {
border-bottom: 0.10em solid #111111;
}
.lightable-classic.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic-2 {
border-top: 3px double #111111;
border-bottom: 3px double #111111;
width: 100%;
margin-bottom: 10px;
}
.lightable-classic-2 tfoot tr td {
border: 0;
}
.lightable-classic-2 tfoot tr:first-child td {
border-top: 3px double #111111;
}
.lightable-classic-2 caption {
color: #222222;
}
.lightable-classic-2 td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic-2 th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic-2 tbody tr:last-child td {
border-bottom: 3px double #111111;
}
.lightable-classic-2 thead tr:last-child th {
border-bottom: 1px solid #111111;
}
.lightable-classic-2.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic-2.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #EEE;
border-collapse: collapse;
margin-bottom: 10px;
}
.lightable-material tfoot tr td {
border: 0;
}
.lightable-material tfoot tr:first-child td {
border-top: 1px solid #EEE;
}
.lightable-material th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
}
.lightable-material td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
border-top: 1px solid #eeeeee;
}
.lightable-material.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody td {
border: 0;
}
.lightable-material.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #ddd;
}
.lightable-material-dark {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #FFFFFF12;
border-collapse: collapse;
margin-bottom: 10px;
background-color: #363640;
}
.lightable-material-dark tfoot tr td {
border: 0;
}
.lightable-material-dark tfoot tr:first-child td {
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF60;
}
.lightable-material-dark td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF;
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark.lightable-hover tbody tr:hover {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody tr:nth-child(even) {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody td {
border: 0;
}
.lightable-material-dark.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #FFFFFF12;
}
.lightable-paper {
width: 100%;
margin-bottom: 10px;
color: #444;
}
.lightable-paper tfoot tr td {
border: 0;
}
.lightable-paper tfoot tr:first-child td {
border-top: 1px solid #00000020;
}
.lightable-paper thead tr:last-child th {
color: #666;
vertical-align: bottom;
border-bottom: 1px solid #00000020;
line-height: 1.15em;
padding: 10px 5px;
}
.lightable-paper td {
vertical-align: middle;
border-bottom: 1px solid #00000010;
line-height: 1.15em;
padding: 7px 5px;
}
.lightable-paper.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-paper.lightable-striped tbody tr:nth-child(even) {
background-color: #00000008;
}
.lightable-paper.lightable-striped tbody td {
border: 0;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Implementation of Shi’s non-degeranate Vuong test</h1>
<h4 class="author">Yves Croissant</h4>



<div id="the-original-vuong-test" class="section level1">
<h1>The original Vuong test</h1>
<p><span class="citation">Vuong (1989)</span> proposed a test for non-nested model. He considers two competing models, <span class="math inline">\(F_\beta = \left\{f(y|z; \beta); \beta \in \beta\right\}\)</span> and <span class="math inline">\(G_\gamma = \left\{g(y|z; \gamma); \gamma \in \Gamma\right\}\)</span>. Denoting <span class="math inline">\(h(y | z)\)</span> the true conditional density. The distance of <span class="math inline">\(F_\beta\)</span> from the true model is measured by the minimum KLIC:</p>
<p><span class="math display">\[
D_f = \mbox{E}^0\left[\ln h(y\mid z)\right] - \mbox{E}^0\left[\ln f(y\mid z;
\beta_*)\right]
\]</span></p>
<p>where <span class="math inline">\(\mbox{E}^0\)</span> is the expected value using the true joint distribution of <span class="math inline">\((y, X)\)</span> and <span class="math inline">\(\beta_*\)</span> is the pseudo-true value of <span class="math inline">\(\beta\)</span><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. As the true model is unobserved, denoting <span class="math inline">\(\theta^\top = (\beta ^ \top, \gamma ^ \top)\)</span>, we consider the difference of the KLIC distance to the true model of model <span class="math inline">\(G_\gamma\)</span> and model <span class="math inline">\(F_\beta\)</span>:</p>
<p><span class="math display">\[ \Lambda(\theta) = D_g - D_f = \mbox{E}^0\left[\ln f(y\mid z;
\beta_*)\right]- \mbox{E}^0\left[\ln g(y\mid z; \gamma_*)\right] =
\mbox{E}^0\left[\ln \frac{f(y\mid z; \beta_*)}{g(y\mid z;
\gamma_*)}\right] \]</span></p>
<p>The null hypothesis is that the distance of the two models to the true models are equal or, equivalently, that: <span class="math inline">\(\Lambda=0\)</span>. The alternative hypothesis is either <span class="math inline">\(\Lambda&gt;0\)</span>, which means that <span class="math inline">\(F_\beta\)</span> is better than <span class="math inline">\(G_\gamma\)</span> or <span class="math inline">\(\Lambda&lt;0\)</span>, which means that <span class="math inline">\(G_\gamma\)</span> is better than <span class="math inline">\(F_\beta\)</span>. Denoting, for a given random sample of size <span class="math inline">\(N\)</span>, <span class="math inline">\(\hat{\beta}\)</span> and <span class="math inline">\(\hat{\gamma}\)</span> the maximum likelihood estimators of the two models and <span class="math inline">\(\ln L_f(\hat{\beta})\)</span> and <span class="math inline">\(\ln L_g(\hat{\gamma})\)</span> the maximum value of the log-likelihood functions of respectively <span class="math inline">\(F_\beta\)</span> and <span class="math inline">\(G\gamma\)</span>, <span class="math inline">\(\Lambda\)</span> can be consistently estimated by:</p>
<p><span class="math display">\[
\hat{\Lambda}_N = \frac{1}{N} \sum_{n = 1} ^ N  \left(\ln f(y_n \mid
x_n, \hat{\beta}) - \ln g(y_n \mid x_n, \hat{\gamma})\right)
= \frac{1}{N} \left(\ln L_f(\hat{\beta}) - \ln L_g(\hat{\gamma})\right)
\]</span></p>
<p>which is the likelihood ratio divided by the sample size. Note that the statistic of the standard likelihood ratio test, suitable for nested models is <span class="math inline">\(2 \left(\ln L^f(\hat{\beta}) - \ln L^g(\hat{\gamma})\right)\)</span>, which is <span class="math inline">\(2 N \hat{\Lambda}_N\)</span>.</p>
<p>The variance of <span class="math inline">\(\Lambda\)</span> is:</p>
<p><span class="math display">\[
\omega^2_* = \mbox{V}^o \left[\ln \frac{f(y \mid x; \beta_*)}{g(y
\mid x; \gamma_*)}\right]
\]</span></p>
<p>which can be consistently estimated by:</p>
<p><span class="math display">\[
\hat{\omega}_N^2 = \frac{1}{N} \sum_{n = 1} ^ N  \left(\ln f(y_n \mid
x_n, \hat{\beta}) - \ln g(y_n \mid x,_n \hat{\gamma})\right) ^ 2 - 
\hat{\Lambda}_N ^ 2
\]</span></p>
<p>Three different cases should be considered:</p>
<ul>
<li>when the two models are nested, <span class="math inline">\(\omega^2_*\)</span> is necessarily 0,</li>
<li>when the two models are overlapping (which means than the models coincides for some values of the parameters), <span class="math inline">\(\omega^2_*\)</span> <em>may be</em> equal to 0 or not,</li>
<li>when the two models are stricly non-nested, <span class="math inline">\(\omega^2_*\)</span> is necessarely strictly positive.</li>
</ul>
<p>The distribution of the statistic depends on whether <span class="math inline">\(\omega^2_*\)</span> is zero or positive. If <span class="math inline">\(\omega^2_*\)</span> is positive, the statistic is <span class="math inline">\(\hat{T}_N = \sqrt{N}\frac{\hat{\Lambda}_N}{\hat{\omega}_N}\)</span> and, under the null hypothesis that the two models are equivalent, follows a standard normal distribution. This is the case for two strictly non-nested models.</p>
<p>On the contrary, if <span class="math inline">\(\omega^2_* = 0\)</span>, the distribution is much more complicated. We need to define two matrices: <span class="math inline">\(A\)</span> contains the expected values of the second derivates of <span class="math inline">\(\Lambda\)</span>:</p>
<p><span class="math display">\[
A(\theta_*) = \mbox{E}^0\left[\frac{\partial^2 \Lambda}{\partial \theta
\partial \theta ^ \top}\right] = 
\mbox{E}^0\left[\begin{array}{cc}
\frac{\partial^2 \ln f}{\partial \beta \partial \beta ^
\top} &amp; 0 \\
0 &amp; -\frac{\partial^2 \ln g}{\partial \beta \partial \beta ^
\top}
\end{array}\right]
=
\left[
\begin{array}{cc}
A_f(\beta_*) &amp; 0 \\
0 &amp; - A_g(\gamma_*)
\end{array}
\right]
\]</span></p>
<p>and <span class="math inline">\(B\)</span> the variance of its first derivatives:</p>
<p><span class="math display">\[
B(\theta_*) =
\mbox{E}^0\left[\frac{\partial \Lambda}{\partial
\theta}\frac{\partial \Lambda}{\partial \theta ^ \top}\right]=
\mbox{E}^0\left[
\left(\frac{\partial \ln f}{\partial \beta}, 
- \frac{\partial \ln g}{\partial \gamma} \right)
\left(\frac{\partial \ln f}{\partial \beta ^ \top}, 
- \frac{\partial \ln g}{\partial \gamma ^ \top} \right)
\right]
= \mbox{E}^0\left[
\begin{array}{cc}
\frac{\partial \ln f}{\partial \beta} \frac{\partial \ln f}{\partial
\beta^\top} &amp; 
- \frac{\partial \ln f}{\partial \beta} \frac{\partial \ln g}{\partial
\gamma ^ \top} \\
- \frac{\partial \ln g}{\partial \gamma} \frac{\partial \ln f}{\partial
  \beta^\top} &amp; 
\frac{\partial \ln g}{\partial \gamma} \frac{\partial \ln g}{\partial \gamma^\top}
\end{array}
\right]
\]</span></p>
<p>or:</p>
<p><span class="math display">\[
B(\theta_*) =  
\left[
\begin{array}{cc}
B_f(\beta_*) &amp; - B_{fg}(\beta_*, \gamma_*) \\
- B_{gf}(\beta_*, \gamma_*) &amp; B_g(\gamma_*)
\end{array}
\right]
\]</span></p>
<p>Then:</p>
<p><span class="math display">\[
W(\theta_*) =  B(\theta_*) \left[-A(\theta_*)\right] ^ {-1}= 
\left[
\begin{array}{cc}
-B_f(\beta_*) A^{-1}_f(\beta_*) &amp; - B_{fg}(\beta_*, \gamma_*)
A^{-1}_g(\gamma_*) \\
B_{gf}(\gamma_*, \beta_*) A^{-1}_f(\beta_*) &amp; B_g(\gamma_*)
A^{-1}_g(\gamma_*)
\end{array}
\right]
\]</span></p>
<p>Denote <span class="math inline">\(\lambda_*\)</span> the eigen values of <span class="math inline">\(W\)</span>. When <span class="math inline">\(\omega_*^2 = 0\)</span> (which is always the case for nested models), the statistic is the one used in the standard likelihood ratio test: <span class="math inline">\(2 (\ln L_f - \ln L_g) = 2 N \hat{\Lambda}_N\)</span> which, under the null, follows a weighted <span class="math inline">\(\chi ^ 2\)</span> distribution with weights equal to <span class="math inline">\(\lambda_*\)</span>. The Vuong test can be seen in this context as a more robust version of the standard likelihood ratio test, because it doesn’t assume, under the null, that the larger model is correctly specified.</p>
<p>Note that, if the larger model is correctly specified, the information matrix equality implies that <span class="math inline">\(B_f(\theta_*)-A_f(\theta_*)\)</span>. In this case, the two matrices on the diagonal of <span class="math inline">\(W\)</span> reduce to <span class="math inline">\(-I_{K_f}\)</span> and <span class="math inline">\(I_{K_g}\)</span>, the trace of <span class="math inline">\(W\)</span> to <span class="math inline">\(K_g - K_f\)</span> and the distribution of the statistic under the null reduce to a <span class="math inline">\(\chi^2\)</span> with <span class="math inline">\(K_g - K_f\)</span> degrees of freedom.</p>
<p>The <span class="math inline">\(W\)</span> matrice can be consistently estimate by computing the first and the second derivatives of the likelihood functions of the two models for <span class="math inline">\(\hat{\theta}\)</span>. For example,</p>
<p><span class="math display">\[
\hat{A}_f(\hat{\beta}) = \frac{1}{N}
\sum_{n= 1} ^ N \frac{\partial^2 \ln f}{\partial \beta \partial
\beta ^ \top}(\hat{\beta}, x_n, y_n)
\]</span></p>
<p><span class="math display">\[ \hat{B}_{fg}(\hat{\theta})= \frac{1}{N} \sum_{n=1}^N
\frac{\partial \ln f}{\partial \beta}(\hat{\beta}, x_n, y_n)
\frac{\partial \ln g}{\partial \gamma^\top}(\hat{\gamma}, x_n, y_n)
\]</span></p>
<p>For the overlapping case, the test should be performed in two steps:</p>
<ul>
<li>the first step consists on testing whether <span class="math inline">\(\omega_*^*\)</span> is 0 or not. This hypothesis is based on the statistic <span class="math inline">\(N \hat{\omega} ^ 2\)</span> which, under the null (<span class="math inline">\(\omega_*^2=0\)</span>) follows a weighted <span class="math inline">\(\chi ^ 2\)</span> distributions with weights equal to <span class="math inline">\(\lambda_* ^ 2\)</span>. If the null hypothesis is not rejected, the test stops at this step and the conclusion is that the two models are equivalent,</li>
<li>if the null hypothesis is reject, the second step consists on applying the test for non-nested models previously described.</li>
</ul>
</div>
<div id="the-non-degenerate-vuong-test" class="section level1">
<h1>The non-degenerate Vuong test</h1>
<p><span class="citation">Shi (2015)</span> proposed a non-degenerate version of the <span class="citation">Vuong (1989)</span> test. She shows that the Vuong test has size distortion, leading to subsequent overrejection. The cause of this problem is that the distribution of <span class="math inline">\(\hat{\Lambda}\)</span> is discontinuous in the <span class="math inline">\(\omega^2\)</span> parameter (namely a normal distribution if <span class="math inline">\(\omega^2 &gt; 0\)</span> and a distribution related to a weight <span class="math inline">\(\chi^2\)</span> distribution if <span class="math inline">\(\omega^2 = 0\)</span>). Especially in small samples, it may be difficult to distinguish a positive versus a zero value of <span class="math inline">\(\omega ^ 2\)</span> because of sampling error. To solve this problem, using local asymptotic theory, <span class="citation">Shi (2015)</span> showed that, rewriting the Vuong statistic as:</p>
<p><span class="math display">\[
\hat{T} = \frac{N \hat{\Lambda}_N}{\sqrt{N \hat{\omega} ^ 2_N}}
\]</span></p>
<p>the asymptotic distribution of the numerator and of the square of the denominator of the Vuong statistic is the same as:</p>
<p><span class="math display">\[
\left(
\begin{array}{cc} 
N \hat{\Lambda}_N \\ N \hat{\omega} ^ 2 _ N
\end{array}
\right)
\rightarrow^d 
\left(
\begin{array}{cc} 
J_\Lambda \\ J_\omega 
\end{array}
\right) 
= 
\left(
\begin{array}{cc} 
\sigma z_\omega - z_\theta ^ \top V z_\theta / 2 \\ 
\sigma ^ 2 - 2 \sigma \rho_* ^ \top V z_\theta + z_\theta ^ \top V ^ 2
z_\theta
\end{array}
\right)
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\left(\begin{array}{c}z_\omega \\ z_\theta \end{array}\right) \sim
N \left(0, \left(\begin{array}{cc} 1 &amp; \rho_* ^ \top \\ \rho_* &amp; I \end{array}\right) \right),
\]</span></p>
<p><span class="math inline">\(\rho_*\)</span> is a vector of length <span class="math inline">\(K_f + K_g\)</span>, <span class="math inline">\(\sigma\)</span> a positive scalar and V is the diagonal matrix containing the eigen values of <span class="math inline">\(B ^ {\frac{1}{2}} A ^ {-1} B ^ {\frac{1}{2}}\)</span>.</p>
<p>Based on this result, <span class="citation">Shi (2015)</span> showed:</p>
<ul>
<li>that the expected value of the numerator is <span class="math inline">\(-\mbox{trace}(V) / 2\)</span>, the classical Vuong statistic is therefore biased and this bias can be severe in small samples and when the degree of parametrization of the two models are very different<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>,</li>
<li>that the denominator, being random, can take values close to zero with a significant probability, which can generate fat tails in the distribution of the statistic.</li>
</ul>
<p><span class="citation">Shi (2015)</span> therefore proposed to modify the numerator of the Vuong statistic:</p>
<p><span class="math display">\[\hat{\Lambda}^{\mbox{mod}}_N = \hat{\Lambda}_N + \frac{\mbox{tr}(V)}{2 N}\]</span></p>
<p>and to add a constant to the denominator, so that:</p>
<p><span class="math display">\[
\left(\hat{\omega}^{\mbox{mod}}(c)\right) ^ 2 = \hat{\omega} ^ 2 + c \;
\mbox{tr}(V) ^ 2 / N
\]</span></p>
<p>The non-degenarate Vuong test is then:</p>
<p><span class="math display">\[
T_N^{\mbox{mod}} =
\frac{\hat{\Lambda}^{\mbox{mod}}_N}{\hat{\omega}^{\mbox{mod}}}=
\sqrt{N}\frac{\hat{\Lambda}_N + \mbox{tr}(V) / 2N}{\sqrt{\hat{\omega}
^ 2 + c \;\mbox{tr}(V) ^ 2 / N}}
\]</span></p>
<p>The distribution of the modified Vuong statistic can be estimated by simulations: drawing in the distribution of <span class="math inline">\((z_\omega, z_\theta^\top)\)</span>, we compute for every draw <span class="math inline">\(J_\Lambda\)</span>, <span class="math inline">\(J_\omega\)</span> and <span class="math inline">\(J_\Lambda / \sqrt{J_\omega}\)</span>. As <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\rho_*\)</span> can’t be estimated consistently, the supremum other these parameters are taken, and <span class="citation">Shi (2015)</span> indicates that <span class="math inline">\(\rho_*\)</span> should be in this case a vector where all the elements are zero except for the one that coincides with the highest absolute value of <span class="math inline">\(V\)</span> which is set to 1.</p>
<p>The Shi test is then computed as follow:</p>
<ol class="example" style="list-style-type: decimal">
<li>start with a given size for the test, say <span class="math inline">\(\alpha = 0.05\)</span>,</li>
<li>for a given value of <span class="math inline">\(c\)</span>, choose <span class="math inline">\(\sigma\)</span> which maximize the simulated critical value for <span class="math inline">\(c\)</span> and <span class="math inline">\(\alpha\)</span>,</li>
<li>adjust <span class="math inline">\(c\)</span> so that this critical value equals the normal critical value, up to a small disperency (say 0.1); for example, if the size is 5%, the target is <span class="math inline">\(v_{1 - \alpha / 2} = 1.96 + 0.1 = 2.06\)</span>,</li>
<li>compute <span class="math inline">\(\hat{T}_N^{\mbox{mod}}\)</span> for the given values of <span class="math inline">\(c\)</span> and <span class="math inline">\(\sigma\)</span> ; if <span class="math inline">\(\hat{T}_N^{\mbox{mod}} &gt; v_{1 - \alpha / 2}\)</span>, reject the null hypothesis at the <span class="math inline">\(\alpha\)</span> level,</li>
<li>to get a p-value, if <span class="math inline">\(\hat{T}_N^{\mbox{mod}} &gt; v_{1 - \alpha / 2}\)</span> increase <span class="math inline">\(\alpha\)</span> and repeat the previous steps until a new value of <span class="math inline">\(\alpha\)</span> is obtained so that <span class="math inline">\(\hat{T}_N^{\mbox{mod}} = v_{1 - \alpha^* / 2}\)</span>, <span class="math inline">\(\alpha^*\)</span> being the p-value of the test.</li>
</ol>
</div>
<div id="simulations" class="section level1">
<h1>Simulations</h1>
<p><span class="citation">Shi (2015)</span> provides an example of simulations of non-nested linear models that shows that the distribution of the Vuong statistic can be very different from a standard normal. The data generating process used for the simulations is:</p>
<p><span class="math display">\[
y = 1 + \sum_{k = 1} ^ {K_f} z^f_k + \sum_{k = 1} ^ {K_g} z^g_k + \epsilon
\]</span></p>
<p>where <span class="math inline">\(z^f\)</span> is the set of <span class="math inline">\(K_f\)</span> covariates that are used in the first model and <span class="math inline">\(z^g\)</span> the set of <span class="math inline">\(K_g\)</span> covariates used in the second model and <span class="math inline">\(\epsilon \sim N(0, 1 - a ^ 2)\)</span>. <span class="math inline">\(z^f_k \sim N(0, a / \sqrt{K_f})\)</span> and <span class="math inline">\(z^g_k \sim N(0, a / \sqrt{K_g})\)</span>, so that the explained variance explained by the two competing models is the same (equal to <span class="math inline">\(a ^ 2\)</span>) and the null hypothesis of the Vuong test is true. The <code>vuong_sim</code> unables to simulate values of the Vuong test. As in <span class="citation">Shi (2015)</span>, we use a very different degree of parametrization for the two models, with <span class="math inline">\(K_f = 15\)</span> and <span class="math inline">\(K_G = 1\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(micsr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>Vuong &lt;-<span class="st"> </span><span class="kw">vuong_sim</span>(<span class="dt">N =</span> <span class="dv">100</span>, <span class="dt">R =</span> <span class="dv">1000</span>, <span class="dt">Kf =</span> <span class="dv">15</span>, <span class="dt">Kg =</span> <span class="dv">1</span>, <span class="dt">a =</span> <span class="fl">0.5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">head</span>(Vuong)</span></code></pre></div>
<pre><code>## [1]  1.5588591  2.5625929 -1.0904569  0.7207765  2.7263322  1.1310495</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">mean</span>(Vuong)</span></code></pre></div>
<pre><code>## [1] 1.119354</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">mean</span>(<span class="kw">abs</span>(Vuong) <span class="op">&gt;</span><span class="st"> </span><span class="fl">1.96</span>)</span></code></pre></div>
<pre><code>## [1] 0.207</code></pre>
<p>We can see that the the mean of the statistic for the 1000 replications is far away from 0, which means that the numerator of the Vuong statistic is seriously biased. 20.7% of the values of the statistic are greater than the critical value so that the Vuong test will lead in such context a noticeable overrejection. The empirical pdf is shown in the following figure, along with the normal pdf.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">Vuong =</span> Vuong)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Vuong)) <span class="op">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_function</span>(<span class="dt">fun =</span> dnorm, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="implementation-of-the-non-degenarate-vuong-test" class="section level1">
<h1>Implementation of the non-degenarate Vuong test</h1>
<p>The <code>micsr</code> package provides a <code>ndvuong</code> function that implements the classical Vuong test. It has a <code>nest</code> argument (that is <code>FALSE</code> by default but can be set to <code>TRUE</code> to get the nested version of the Vuong test). This package also provide a <code>llcont</code> generic which returns a vector of length <span class="math inline">\(N\)</span> containing the contribution of every observation to the log-likelihood.</p>
<p>The <code>ndvuong</code> package provides the <code>ndvuong</code> function. As for the <code>vuongtest</code> function, the two main arguments are two fitted models (say <code>model1</code> and <code>model2</code>). The <span class="math inline">\(\hat{\Lambda}_n\)</span> vector is obtained using <code>llcont(model1) - llcont(model2)</code>. The relevant matrices <span class="math inline">\(A_i\)</span> and <span class="math inline">\(B_i\)</span> are computed from the fitted models using the <code>estfun</code> and the <code>meat</code> functions from the sandwich package. More precisely, <span class="math inline">\(A^{-1}\)</span> is <code>bdiag(-bread(model1), bread(model2)</code><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> and <span class="math inline">\(B\)</span> is <code>crossprod(estfun(model1), - estfun(model2)) / N</code>, where <code>N</code> is the sample size. Therefore, the <code>ndvuong</code> function can be used with any models for which a <code>llcont</code>, a <code>estfun</code> and a <code>bread</code> method is available.</p>
</div>
<div id="applications" class="section level1">
<h1>Applications</h1>
<div id="voter-turnout" class="section level2">
<h2>Voter turnout</h2>
<p>The first application is the example used in <span class="citation">Shi (2015)</span> and is used to compare our <strong>R</strong> program with Shi’s <strong>stata</strong>’s program. <span class="citation">Coate and Conlin (2004)</span> used several models of electoral participation, using data concerning referenda about alcool sales regulation in Texas. Three models are estimated: the prefered group-utilitarian model, a “simple, but plausible, alternative: the intensity model” and a reduced form model estimated by the seemingly unrelated residuals method. They are provided in the <code>ndvuong</code> package as <code>turnout</code>, a list of three fitted models<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>. The results of the Shi test are given below. We first compute the Shi statistic for an error level of 5%. We therefore set the <code>size</code> argument to 0.05 (this is actually the default value) and the <code>pval</code> argument to FALSE.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;micsr&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>test &lt;-<span class="st"> </span><span class="kw">ndvuong</span>(turnout<span class="op">$</span>group, turnout<span class="op">$</span>intens, <span class="dt">size =</span> <span class="fl">0.05</span>, <span class="dt">pval =</span> <span class="ot">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>test</span></code></pre></div>
<pre><code>## 
##  Non-degenerate Vuong test for non-nested models
## 
## data:  turnout$group-turnout$intens
## z = 1.7759, size = 0.050000, vuong_stat = 2.084528, constant =
## 0.381107, crit-value = 2.059963, sum e.v. = -10.997224, vuong_p.value =
## 0.018556
## alternative hypothesis: different models</code></pre>
<p>The Shi statistic is 1.776, which is smaller that the critical value 2.06. Therefore, based on the Shi test, we can’t reject the hypothesis that the two competing models are equivalent at the 5% level. The value of the constant <span class="math inline">\(c\)</span> is also reported, as is the sum of the eigen values of the <span class="math inline">\(V\)</span> matrix (<code>sum e.v.</code>). The classical Vuong statistic is also reported (2.085) and is greater than the 5% normal critical value (the p-value is 0.019). Therefore, the classical Vuong test and the non-degenerate version lead to opposite conclusions at the 5% level.</p>
<p>To get only the classical Vuong test, the <code>nd</code> argument can be set to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">ndvuong</span>(turnout<span class="op">$</span>group, turnout<span class="op">$</span>intens, <span class="dt">nd =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Vuong test for non-nested models
## 
## data:  turnout$group-turnout$intens
## z = 2.0845, p-value = 0.01856
## alternative hypothesis: different models</code></pre>
<p>To get the p-value of the non-degenerate Vuong test, the <code>pval</code> argument should be set to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>test &lt;-<span class="st"> </span><span class="kw">ndvuong</span>(turnout<span class="op">$</span>group, turnout<span class="op">$</span>intens, <span class="dt">pval =</span> <span class="ot">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>test</span></code></pre></div>
<pre><code>## 
##  Non-degenerate Vuong test for non-nested models
## 
## data:  turnout$group-turnout$intens
## z = 1.8125, vuong_stat = 2.084528, constant = 0.000000, sum e.v. =
## -10.997224, vuong_p.value = 0.018556, p-value = 0.0864
## alternative hypothesis: different models</code></pre>
<p>The results indicate that the p-value is 0.086, which confirms that the Shi test concludes that the two model are equivalent at the 5% level.</p>
<!-- ## The demand for medical care (stricly non-nested models) -->
<!-- The second example compares different count models, using data on -->
<!-- demand for medical care. These data were used by @DEB:TRIV:97 and by -->
<!-- @ZEIL:KLEI:JACK:08. They are available as `AER::NMES1988`. The -->
<!-- response is the number of physician office visits (`visits`) and the covariates -->
<!-- are the number of hospital stays (`hosp`), a factor indicating -->
<!-- self-perceived health status (`health`), the number of chronic -->
<!-- conditions (`chronic`), the gender (`gender`), the number of years of -->
<!-- education (`school`) and a factor indicating whether the individual is -->
<!-- covered by private insurance (`insurance`).  -->
<!-- The poisson model is often two simple as the poisson -->
<!-- distribution hypothesis may be rejected for two reasons: -->
<!-- - the first one is that it imposes the equality of the conditional -->
<!--   expectation and variance and that, with real data, we often observe -->
<!--   that the variance is much larger than the expectation, -->
<!-- - the second one is that the probability of 0 for real data are often -->
<!--   much larger that the one implied by the poisson distribution.  -->
<!-- We'll deal here only with the second problem. Two competing models can -->
<!-- be used: -->
<!-- - the zero-inflated (or zip) model, as it names suggests, inflates the -->
<!--   probability of zero, compared to the Poisson model, -->
<!-- - the hurdle model is a two-part model, with a binomial model which -->
<!--   explains the probability of 0 and a zero-truncated poisson model -->
<!--   that explains the probabilities of positive values. -->
<!-- These two models can be estimated using respectively `pscl::zeroinfl` -->
<!-- and `pscl::hurdle`. -->
<!-- ```{r } -->
<!-- data("NMES1988", package = "AER") -->
<!-- zi <- pscl::zeroinfl(visits ~ hospital + health + chronic + gender + school + insurance, -->
<!--                      data = NMES1988) -->
<!-- hl <- pscl::hurdle(visits ~ hospital + health + chronic + gender + school + insurance, -->
<!--                    data = NMES1988) -->
<!-- ``` -->
<!-- We first use two previous implementation of the classical Vuong -->
<!-- test. The first one is `pscl::vuong`. -->
<!-- ```{r } -->
<!-- pscl::vuong(zi, hl) -->
<!-- ``` -->
<!-- The alternative hypothesis is writen as the first model being better -->
<!-- than the second one, the p-value is therefore one-sided. The null -->
<!-- hypothesis is therefore rejected at the 5% level (p-value = 0.0143), -->
<!-- and it's also the case if the alternative were writen as one model -->
<!-- being better than the other one (in this case, the p-value would be -->
<!-- $0.0143 \times 2 = 0.0286$). -->
<!-- An other implementation of the classical Vuong test is -->
<!-- `nonnest2::vuong`. -->
<!-- ```{r } -->
<!-- library(nonnest2) -->
<!-- nonnest2::vuongtest(zi, hl) -->
<!-- ``` -->
<!-- This implementation of the test proceeds in two steps. The first step -->
<!-- is the variance test, which is normaly only relevant when the two -->
<!-- models are overlapping. The hypothesis that $\omega ^ 2 = 0$ is -->
<!-- rejected at the 5% level (p-value of 0.0124), so that the second step -->
<!-- is performed. Two alternatives hypothesis are used, the first one -->
<!-- being that the first model is better than the second model and the -->
<!-- second one being the opposite. Therefore, one sided p-values are used -->
<!-- and we get the same conclusion than previously that the zero-inflated -->
<!-- Poisson model is better that the hurdle model at the 5% level. -->
<!-- We then compute the non-degenerate Vuong test: -->
<!-- ```{r } -->
<!-- ndvuong(zi, hl) -->
<!-- ``` -->
<!-- The null hypothesis that the two models are equivalent is not -->
<!-- rejected using the non-degenerate Vuong test, as the p-value is now -->
<!-- equal to 0.057. -->
</div>
<div id="transport-mode-choice-nested-models" class="section level2">
<h2>Transport mode choice (nested models)</h2>
<p>The third example concerns transport mode choice in Canada. The dataset, provided by the <code>mlogit</code> package is called <code>ModeCanada</code> and has been used extensively in the transport demand litterature <span class="citation">(see in particular <span class="citeproc-not-found" data-reference-id="BHAT:95"><strong>???</strong></span>; <span class="citeproc-not-found" data-reference-id="KOPP:WEN:00"><strong>???</strong></span>; and <span class="citeproc-not-found" data-reference-id="WEN:KOPP:01"><strong>???</strong></span>)</span>. The following example is from <span class="citation">(<span class="citeproc-not-found" data-reference-id="CROI:20"><strong>???</strong></span>)</span>. The raw data set is first transformed to make it suitable for the estimation of discrete choice models. The sample is restricted to the individuals for which 4 transport modes are available (bus, air, train and car).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;mlogit&quot;</span>)</span></code></pre></div>
<pre><code>## Le chargement a nécessité le package : dfidx</code></pre>
<pre><code>## 
## Attachement du package : &#39;dfidx&#39;</code></pre>
<pre><code>## L&#39;objet suivant est masqué depuis &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## 
## Attachement du package : &#39;mlogit&#39;</code></pre>
<pre><code>## Les objets suivants sont masqués depuis &#39;package:micsr&#39;:
## 
##     rg, scoretest, stdev</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;ModeCanada&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>MC &lt;-<span class="st"> </span><span class="kw">mlogit.data</span>(ModeCanada, <span class="dt">subset =</span> noalt <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, <span class="dt">chid.var =</span> <span class="st">&quot;case&quot;</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>                  <span class="dt">alt.var =</span> <span class="st">&quot;alt&quot;</span>, <span class="dt">drop.index =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>We first estimate the simplest discrete choice model, which is the multinomial logit model. The bus share being negligible, the choice set is restricted to the three other modes and the reference mode is set to <code>car</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>ml &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span>freq <span class="op">+</span><span class="st"> </span>cost <span class="op">+</span><span class="st"> </span>ivt <span class="op">+</span><span class="st"> </span>ovt <span class="op">|</span><span class="st"> </span>urban <span class="op">+</span><span class="st"> </span>income, MC, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>             <span class="dt">reflevel =</span> <span class="st">&#39;car&#39;</span>, <span class="dt">alt.subset =</span> <span class="kw">c</span>(<span class="st">&quot;car&quot;</span>, <span class="st">&quot;train&quot;</span>, <span class="st">&quot;air&quot;</span>))</span></code></pre></div>
<p>This model relies on the hypothesis that the unobserved component of the utility functions for the different modes are independent and identical Gumbell variables. <span class="citation">(<span class="citeproc-not-found" data-reference-id="BHAT:95"><strong>???</strong></span>)</span> proposed the heteroscedastic logit for which the errors follow a general Gumbell distributions with a supplementary scale parameter to be estimated. As the overall scale of utility is not identified, the scale parameter of the reference alternative (car) is set to one.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>hl &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span>freq <span class="op">+</span><span class="st"> </span>cost <span class="op">+</span><span class="st"> </span>ivt <span class="op">+</span><span class="st"> </span>ovt <span class="op">|</span><span class="st"> </span>urban <span class="op">+</span><span class="st"> </span>income, MC, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a>             <span class="dt">reflevel =</span> <span class="st">&#39;car&#39;</span>, <span class="dt">alt.subset =</span> <span class="kw">c</span>(<span class="st">&quot;car&quot;</span>, <span class="st">&quot;train&quot;</span>, <span class="st">&quot;air&quot;</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>             <span class="dt">heterosc =</span> <span class="ot">TRUE</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a><span class="kw">coef</span>(<span class="kw">summary</span>(hl))</span></code></pre></div>
<pre><code>##                       Estimate  Std. Error   z-value     Pr(&gt;|z|)
## (Intercept):train  0.678393435 0.332762598  2.038671 4.148288e-02
## (Intercept):air    0.656754399 0.468163091  1.402832 1.606668e-01
## freq               0.063924677 0.004916769 13.001360 0.000000e+00
## cost              -0.026961457 0.004283139 -6.294789 3.078178e-10
## ivt               -0.009680773 0.001053874 -9.185892 0.000000e+00
## ovt               -0.032165526 0.003593007 -8.952258 0.000000e+00
## urban:train        0.797131578 0.120739176  6.602096 4.053868e-11
## urban:air          0.445472634 0.082160945  5.421951 5.895197e-08
## income:train      -0.012597857 0.003994180 -3.154053 1.610196e-03
## income:air         0.018859983 0.003215926  5.864558 4.503294e-09
## sp.train           1.237182865 0.110460959 11.200182 0.000000e+00
## sp.air             0.540323852 0.111835294  4.831425 1.355592e-06</code></pre>
<p>The two supplementary coefficients are <code>sp.train</code> and <code>sp.air</code>. The student statistics reported are irrelevant because they test the hypothesis that these parameters are 0, as the relevant hypothesis of homoscedasticity is that both of them equal one. The heteroscedastic logit being nested in the multinomial logit model, we can first use the three classical tests: the Wald test (based on the unconstrained model <code>hl</code>), the score test (based on the constrained model <code>ml</code>) and the likelihood ratio model (based on the comparison of both models).</p>
<p>To perform the Wald test, we use <code>lmtest::waldtest</code>, for which a special method is provided by the <strong>mlogit</strong> package. The arguments are the unconstrained model (<code>hl</code>) and the update that should be used in order to get the constrained model (<code>heterosc = FALSE</code>). To compute the scoretest, we use <code>mlogit::scoretest</code>, for which the arguments are the constrained model (<code>ml</code>) and the update that should be used in order to get the unconstrained model (<code>heterosc = TRUE</code>). Finally, the likelihood ratio test is performed using <code>lmtest::lrtest</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>lmtest<span class="op">::</span><span class="kw">waldtest</span>(hl, <span class="dt">heterosc =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Wald test
## 
## data:  homoscedasticity
## chisq = 25.196, df = 2, p-value = 3.38e-06</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="kw">scoretest</span>(ml, <span class="dt">heterosc =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  score test
## 
## data:  heterosc = TRUE
## chisq = 9.4883, df = 2, p-value = 0.008703
## alternative hypothesis: heteroscedastic model</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>lmtest<span class="op">::</span><span class="kw">lrtest</span>(hl, ml)</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: choice ~ freq + cost + ivt + ovt | urban + income
## Model 2: choice ~ freq + cost + ivt + ovt | urban + income
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
## 1  12 -1838.1                       
## 2  10 -1841.6 -2 6.8882    0.03193 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The three statistics are <span class="math inline">\(\chi ^2\)</span> with two degrees of freedom under the null hypothesis of homoscedascticity. The three tests reject the null hypothesis at the 5% level, and even at the 1% level for the Wald and the score test. These three tests relies on the hypothesis that, under the null, the constrained model is the true model. We can get rid of this hypothesis using a Vuong test. Note the use of the <code>nested</code> argument that is set to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="kw">ndvuong</span>(hl, ml, <span class="dt">nested =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Non-degenerate Vuong test for nested models
## 
## data:  hl-ml
## z = 0.4554, vuong_stat = 6.888241, vuong_p.value = 0.047927, p-value =
## 0.211
## alternative hypothesis: different models</code></pre>
<p>The homoscedasticity hypothesis is still rejected at the 5% level for the classical Vuong test (the p-value is 0.048), but it is not using the non-degenerate Vuong test (p-value of 0.211).</p>
</div>
<div id="transport-mode-choice-overlapping-models" class="section level2">
<h2>Transport mode choice (overlapping models)</h2>
<p>We consider finally another dataset from <strong>mlogit</strong> called <code>RiskyTransport</code>, that has been used by <span class="citation">(<span class="citeproc-not-found" data-reference-id="LEON:MIGU:17"><strong>???</strong></span>)</span> and concerns the choice of one mode (among water-taxi, ferry, hovercraft and helicopter) for trips from Sierra Leone’s international airport to downtown Freetown.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="kw">library</span>(<span class="st">&quot;mlogit&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a><span class="kw">data</span>(<span class="st">&quot;RiskyTransport&quot;</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>RT &lt;-<span class="st"> </span><span class="kw">mlogit.data</span>(RiskyTransport, <span class="dt">shape =</span> <span class="st">&quot;long&quot;</span>, <span class="dt">choice =</span> <span class="st">&quot;choice&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a>                  <span class="dt">chid.var =</span> <span class="st">&quot;chid&quot;</span>, <span class="dt">alt.var =</span> <span class="st">&quot;mode&quot;</span>, <span class="dt">id.var =</span> <span class="st">&quot;id&quot;</span>)</span></code></pre></div>
<p>We estimate models with only one covariate, the generalized cost of the mode. We estimate three models: the basic multinomial logit model, the heteroscedastic model and a nested model where alternatives are grouped in two nests according to the fact that they are fast or slow modes.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>ml &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span>cost, <span class="dt">data =</span> RT)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a>hl &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span>cost , <span class="dt">data =</span> RT, <span class="dt">heterosc =</span> <span class="ot">TRUE</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a>nl &lt;-<span class="st"> </span><span class="kw">mlogit</span>(<span class="dt">formula =</span> choice <span class="op">~</span><span class="st"> </span>cost, <span class="dt">data =</span> RT,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a>             <span class="dt">nests =</span> <span class="kw">list</span>(<span class="dt">fast =</span> <span class="kw">c</span>(<span class="st">&quot;Helicopter&quot;</span>, <span class="st">&quot;Hovercraft&quot;</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a>                          <span class="dt">slow =</span> <span class="kw">c</span>(<span class="st">&quot;WaterTaxi&quot;</span>, <span class="st">&quot;Ferry&quot;</span>)),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a>             <span class="dt">un.nest.el =</span> <span class="ot">TRUE</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a>modelsummary<span class="op">::</span><span class="kw">msummary</span>(<span class="kw">list</span>(<span class="dt">multinomial =</span> ml, <span class="dt">heteroscedastic =</span> hl, <span class="dt">nested =</span>  nl))</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
multinomial
</th>
<th style="text-align:center;">
heteroscedastic
</th>
<th style="text-align:center;">
nested
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept) × WaterTaxi
</td>
<td style="text-align:center;">
1.754
</td>
<td style="text-align:center;">
1.955
</td>
<td style="text-align:center;">
1.581
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.159)
</td>
<td style="text-align:center;">
(0.224)
</td>
<td style="text-align:center;">
(0.127)
</td>
</tr>
<tr>
<td style="text-align:left;">
(Intercept) × Ferry
</td>
<td style="text-align:center;">
1.445
</td>
<td style="text-align:center;">
0.417
</td>
<td style="text-align:center;">
1.359
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.168)
</td>
<td style="text-align:center;">
(0.401)
</td>
<td style="text-align:center;">
(0.118)
</td>
</tr>
<tr>
<td style="text-align:left;">
(Intercept) × Hovercraft
</td>
<td style="text-align:center;">
0.844
</td>
<td style="text-align:center;">
−3.666
</td>
<td style="text-align:center;">
0.461
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.167)
</td>
<td style="text-align:center;">
(2.511)
</td>
<td style="text-align:center;">
(0.148)
</td>
</tr>
<tr>
<td style="text-align:left;">
cost
</td>
<td style="text-align:center;">
−0.009
</td>
<td style="text-align:center;">
−0.022
</td>
<td style="text-align:center;">
−0.007
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.001)
</td>
<td style="text-align:center;">
(0.004)
</td>
<td style="text-align:center;">
(0.001)
</td>
</tr>
<tr>
<td style="text-align:left;">
sp.WaterTaxi
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.745
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.523)
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
sp.Ferry
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
2.840
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.547)
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
sp.Hovercraft
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
4.551
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(1.761)
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
iv
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.554
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
(0.092)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
7172
</td>
<td style="text-align:center;">
7172
</td>
<td style="text-align:center;">
7172
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
3344.2
</td>
<td style="text-align:center;">
3300.7
</td>
<td style="text-align:center;">
3330.4
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:center;">
0.63
</td>
<td style="text-align:center;">
0.63
</td>
<td style="text-align:center;">
0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
mcfadden’s r2
</td>
<td style="text-align:center;">
0.150521340495322
</td>
<td style="text-align:center;">
0.163130381343293
</td>
<td style="text-align:center;">
0.154549418820887
</td>
</tr>
</tbody>
</table>
<p>Compared to ne multinomial model, the heteroscedastic model has 3 supplementary coefficients (the scale parameters for 3 modes, the one for the reference mode being set to 1) and the nested logit model has one supplementary parameter which is the nest elasticity (<code>iv</code> in the table). Both models reduce to the multinomial logit model if:</p>
<ul>
<li><code>sp.WaterTaxi</code> = <code>sp.Ferry</code> = <code>sp.Hovercraft</code> = 1 for the heteroscedastic model,</li>
<li><code>iv</code> = 1 for the nested logit model.</li>
</ul>
<p>Therefore, the two models are over-lapping, as they reduce to the same model (the multinomial logit model) for some values of the parameters.</p>
<p>The first step of the test is the variance test. It can be performed using <code>ndvuong</code> by setting the argument <code>vartest</code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="kw">ndvuong</span>(nl, hl, <span class="dt">vartest =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  variance test
## 
## data:  nl-hl
## w2 = 0.047327, p-value &lt; 2.2e-16
## alternative hypothesis: positive variance</code></pre>
<p>The null hypothesis that <span class="math inline">\(\omega^2 = 0\)</span> is rejected. We can then proceed to the second step, which is the test for non-nested models.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a><span class="kw">ndvuong</span>(hl, nl)</span></code></pre></div>
<pre><code>## 
##  Non-degenerate Vuong test for non-nested models
## 
## data:  hl-nl
## z = 1.7298, vuong_stat = 1.829208, constant = 0.000000, sum e.v. =
## -1.832021, vuong_p.value = 0.033684, p-value = 0.0975
## alternative hypothesis: different models</code></pre>
<p>The classical and the non-degenerate Vuong tests both conclude that the two models are equivalent at the 5% level, but that the heteroscedastic model is better than the nested logit model at the 10% level.</p>
<!-- #' # A poisson model example from the nonnest2 man page -->
<!-- #' data("housing", package = "MASS") -->
<!-- #' house1 <- glm(Freq ~ Infl + Type + Cont, family = poisson, data = housing) -->
<!-- #' house2 <- glm(Freq ~ Infl + Sat,         family = poisson, data = housing) -->
<!-- #' nonnest2::vuongtest(house1, house2) -->
<!-- #' ndvuong(house1, house2) -->
<!-- #' data("bioChemists", package = "pscl") -->
<!-- #' bio1 <- glm(art ~ fem + mar + phd + ment, family=poisson, data=bioChemists) -->
<!-- #' bio2 <- pscl::hurdle(art ~ fem + mar + phd + ment, data=bioChemists) -->
<!-- #' bio3 <- pscl::zeroinfl(art ~ fem + mar + phd + ment, data=bioChemists) -->
<!-- #' nonnest2::vuongtest(bio3, bio2) -->
<!-- #' ndvuong(bio3, bio2) -->
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-COAT:CONL:04">
<p>Coate, Stephen, and Michael Conlin. 2004. “A Group Rule-Utilitarian Approach to Voter Turnout: Theory and Evidence.” <em>American Economic Review</em> 94 (5): 1476–1504.</p>
</div>
<div id="ref-SHI:15">
<p>Shi, Xiaoxia. 2015. “A Nondegenerate Vuong Test.” <em>Quantitative Economics</em>, 85–121.</p>
</div>
<div id="ref-VUON:89">
<p>Vuong, Quang H. 1989. “Likelihood Ratio Tests for Selection and Non-Nested Hypotheses.” <em>Econometrica</em> 57 (2): 397–33.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><span class="math inline">\(\beta_*\)</span> is called the pseudo-true value because <span class="math inline">\(f\)</span> may be an uncorrect model.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>As the trace of V is the same as the trace of <span class="math inline">\(A ^ {-1} B\)</span>, when the information matrix identity holds, it is equal to <span class="math inline">\(-K_f + K_g\)</span>. The bias of the numerator is therefore caused by the difference in the degree of parametrization of the two models.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><code>bdiag</code> if a function that construct a block-diagonal matrix from its arguments.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>The estimation is rather complicated because some linear constraints are used to compute the maximum likelihood estimator in <span class="citation">Coate and Conlin (2004)</span>’s <strong>stata</strong> script. This is the reason why we provide only the results of the estimations, performed using the <code>maxLik</code> package.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
